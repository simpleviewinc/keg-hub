{"version":3,"file":"image.js","sources":["../../../src/components/image/image.js"],"sourcesContent":["import { View } from 'KegView'\nimport PropTypes from 'prop-types'\nimport { Loading } from '../loading'\nimport { checkCall, isFunc } from '@keg-hub/jsutils'\nimport { Image as InternalImage } from '../internal/image'\nimport { useThemeHover, useStyle } from '@keg-hub/re-theme'\nimport { useThemePath } from 'KegHooks'\nimport React, { useState, forwardRef, useRef, useCallback } from 'react'\nimport { useClassList } from 'KegClassList'\nimport { getImgSrc, getPressHandler } from 'KegUtils'\nimport { StyleInjector } from '@keg-hub/re-theme/styleInjector'\n\nconst KegImage = StyleInjector(InternalImage, {\n  displayName: 'Image',\n  className: 'keg-image',\n})\n\n/**\n * Image\n * @summary Custom image wrapper component. All props are optional\n *\n * @param {Object} props - see buttonPropTypes\n * @property {string} props.alt - Alternate text when image fails to load\n * @property {Function} props.onPress - function to do when image is pressed\n * @property {String} props.src - Source url of the image\n * @property {Object} props.style - custom style\n * @property {string} props.type - image type\n * @property {Boolean} props.useLoading - (defaults true) if true, show a loading spinner for remote sources until they load\n *\n */\nexport const Image = forwardRef((props, ref) => {\n  const [ loading, setLoading ] = useState(true)\n  const internalRef = ref || useRef(null)\n\n  const {\n    alt,\n    className,\n    children,\n    onClick,\n    onPress,\n    src,\n    source,\n    styles,\n    type = 'default',\n    themePath = `image.${type}`,\n    useLoading = true,\n    ...attrs\n  } = props\n\n  const builtStyles = useThemePath(themePath, styles)\n  const loadingStyles = useStyle(builtStyles.loading, builtStyles.image)\n  const loadedStyles = useStyle(loadingStyles, builtStyles.loaded)\n\n  const [ imgRef, elementStyle, setStyle ] = useThemeHover(\n    loadedStyles,\n    builtStyles.hover,\n    { internalRef }\n  )\n\n  // Listen for updates to the image loading\n  const onLoad = useCallback(() => {\n    // Update state that the image is loaded\n    checkCall(setLoading, false)\n    // Update the style to use for the loaded image - So we can see it\n    checkCall(setStyle, elementStyle)\n    // Call onLoad in props if it exists\n    checkCall(props.onLoad, props)\n    // Call the imgRef function or set it if it exists\n    isFunc(imgRef)\n      ? imgRef(internalRef.current)\n      : imgRef && (imgRef.current = internalRef.current)\n  }, [ src, source, internalRef.current ])\n\n  return (\n    <View\n      className={useClassList(`keg-image-container`, className)}\n      style={builtStyles.container}\n    >\n      { loading && useLoading && (\n        <Loading\n          className='keg-image-loading'\n          styles={builtStyles.loadingComp}\n        />\n      ) }\n      <KegImage\n        {...attrs}\n        style={loading ? loadingStyles : builtStyles.image}\n        {...getPressHandler(false, onClick, onPress)}\n        {...getImgSrc(false, src, source)}\n        onLoadEnd={onLoad}\n        alt={alt}\n        ref={internalRef}\n      />\n    </View>\n  )\n})\n\nImage.propTypes = {\n  ...InternalImage.propTypes,\n  onPress: PropTypes.func,\n  type: PropTypes.string,\n  alt: PropTypes.string,\n  src: PropTypes.oneOfType([ PropTypes.string, PropTypes.object ]),\n  styles: PropTypes.object,\n}\n"],"names":["KegImage","StyleInjector","InternalImage","displayName","className","Image","forwardRef","props","ref","useState","loading","setLoading","internalRef","useRef","alt","children","onClick","onPress","src","source","styles","type","themePath","useLoading","attrs","builtStyles","useThemePath","loadingStyles","useStyle","image","loadedStyles","loaded","useThemeHover","hover","imgRef","elementStyle","setStyle","onLoad","useCallback","checkCall","isFunc","current","React","View","useClassList","container","Loading","loadingComp","getPressHandler","getImgSrc"],"mappings":"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"}