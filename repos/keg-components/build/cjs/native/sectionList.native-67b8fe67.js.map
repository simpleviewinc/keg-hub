{"version":3,"file":"sectionList.native-67b8fe67.js","sources":["../../../src/utils/components/getElementLayout.native.js","../../../src/utils/components/scrollList.native.js","../../../src/hooks/useScroll/useScroll.native.js","../../../src/components/list/sectionList.native.js"],"sourcesContent":["const defLayout = { top: 0, left: 0 }\n\n/**\n * Placeholder helper for non-web environments\n *\n * @returns {Object} - Default Layout object\n */\nexport const getElementLayout = () => defLayout\n","import { exists } from '@keg-hub/jsutils'\n\n/**\n * Helper method to scroll to an item in a list in a **NATIVE ENVIRONMENT**\n * @function\n * @param {object} props\n * @param {object} [props.listRef] - React Ref of the list component\n * @param {object} [props.top] - Vertical scroll to position\n * @param {object} [props.left] - Horizontal scroll to position\n * @param {boolean} [props.animated=true] - Is scrolling animated\n */\nexport const scrollList = ({ listRef, animated = true, top, left }) => {\n  return listRef?.current?.scrollTo({\n    animated,\n    ...(exists(top) && { y: top }),\n    ...(exists(left) && { x: left }),\n  })\n}\n","const defPos = { scrollX: 0, scrollY: 0 }\n\n/**\n * Placeholder hook for native environments\n * @function\n *\n * @returns {Object} The defPos object\n */\nexport const useScroll = () => defPos\n","import { View } from 'KegView'\nimport PropTypes from 'prop-types'\nimport { Text } from '../typography/text'\nimport { useScroll } from 'KegUseScroll'\nimport { useClassName } from 'KegClassName'\nimport { useThemePath } from '../../hooks/useThemePath'\nimport { useScrollClassName } from 'KegScrollClassName'\nimport { checkCall, noPropObj, noPropArr, get, isFunc } from '@keg-hub/jsutils'\nimport React, {\n  useCallback,\n  useRef,\n  useMemo,\n  useEffect,\n  useState,\n  createRef,\n} from 'react'\nimport { SectionList as RNSectionList, SafeAreaView } from 'react-native'\nimport {\n  renderFromType,\n  getElementLayout,\n  scrollList,\n} from '../../utils/components'\n\n/**\n * Helper hook to add __kegIndex to the sections\n * This allows referencing them as needed without requiring the consumer to add the index\n *\n * @param {Array} sections - Groups of items to be displayed in the SectionList component\n *\n * @return {Array} - sections array with the __kegIndex added\n */\nconst useIndexedSections = (sections, indexBy) => {\n  return useMemo(() => {\n    return sections.map((section, index) => ({\n      ...section,\n      __kegIndex: get(section, indexBy, index),\n    }))\n  }, [sections])\n}\n\n/**\n * Helper hook to allow tracking scrolling between section\n * @param {function} onScrollSectionChange - Consumer Callback for when a section is scrolled\n * @param {number} sectionChangeOffset - Offset the final scroll position by some amount (px)\n * @param {Object} sectionRefs - React ref of all Section divider components.\n * @param {Object} activeSection - Most recent Section in the view calling this hook\n * @param {function} setActiveSection - Update which section is active\n * @param {Object} isScrollingRef - React ref to track if we are scrolling\n *\n * @returns {function} - Method to call when a section is scrolled\n */\nconst useSectionChangeOnScroll = (\n  onScrollSectionChange,\n  sectionChangeOffset,\n  activeSection,\n  setActiveSection,\n  sectionRefs,\n  isScrollingRef\n) => {\n  useScroll(\n    null,\n    useCallback((__, scrollUpdate) =>\n      calculateActiveSection({\n        onScrollSectionChange,\n        sectionChangeOffset,\n        activeSection,\n        setActiveSection,\n        sectionRefs,\n        isScrollingRef,\n        scrollUpdate,\n      })\n    )\n  )\n}\n\n/**\n * Calculates and sets the active section based on current scroll value\n * @param {Object} props\n * @param {function} props.onScrollSectionChange - Consumer Callback for when a section is scrolled\n * @param {number} props.sectionChangeOffset - Offset the final scroll position by some amount (px)\n * @param {Object} props.sectionRefs - React ref of all Section divider components.\n * @param {Object} props.activeSection - Most recent Section in the view calling this hook\n * @param {function} props.setActiveSection - Update which section is active\n * @param {Object} props.isScrollingRef - React ref to track if we are scrolling\n * @param {Object} props.scrollUpdate - contains current scrollX and scrollY values {scrollX, scrollY}\n *\n * @returns {Void}\n */\nconst calculateActiveSection = props => {\n  const {\n    onScrollSectionChange,\n    sectionChangeOffset,\n    activeSection,\n    setActiveSection,\n    sectionRefs,\n    isScrollingRef,\n    scrollUpdate,\n  } = props\n\n  if (!onScrollSectionChange || isScrollingRef.current || !scrollUpdate) return\n\n  const { scrollY } = scrollUpdate\n  // Subtract the custom offset to the scroll position\n  // Because offset should be relative to the element, not the scroll pos\n  const scrollLoc = scrollY - sectionChangeOffset\n\n  // Loop the sections can check their position against the scroll position\n  // Find closest section that's more then the current scroll position\n  const currentSection = Object.entries(sectionRefs.current).reduce(\n    (foundSection, [ __, sectionData ]) => {\n      const checkTop = sectionData?.layout?.top\n      const foundTop = foundSection?.layout?.top\n\n      if (\n        !foundSection ||\n        (scrollLoc >= checkTop && foundTop < checkTop) ||\n        (foundTop > scrollLoc && foundTop > checkTop)\n      )\n        foundSection = sectionData\n\n      return foundSection\n    },\n    false\n  )\n\n  if (!currentSection || currentSection.index === activeSection) return\n\n  checkCall(onScrollSectionChange, currentSection.index)\n  setActiveSection(currentSection.index)\n}\n\n/**\n * Helper hook to allow switching / scrolling to a section when a section change happens\n * @param {boolean} doScrolling - Is automatic scrolling turned on\n * @param {function} onSectionChange - Consumer Callback method for when a section changes\n * @param {number} scrollOffset - Offset the final scroll position by some amount (px)\n * @param {Object} sectionRefs - React ref of all Section divider components.\n * @param {Object} listRef - React ref of the SectionList component\n * @param {Object} isScrollingRef - React ref to track if we are scrolling\n * @param {number} scrollCooldown - Amount of time to wait before allowing scrolling (ms)\n * @param {function} setActiveSection - Update which section is active\n *\n * @returns {function} - Method to call when the current section is changed\n */\nconst useSectionChange = (\n  doScrolling,\n  onSectionChange,\n  scrollOffset,\n  setActiveSection,\n  sectionRefs,\n  listRef,\n  isScrollingRef,\n  scrollCooldown\n) => {\n  return useCallback(\n    index => {\n      // If there's no scrolling call the onSectionChange if it exists\n      if (!doScrolling) return checkCall(onSectionChange, index)\n\n      // Layout of the SectionHeader should be set in the useEffect hook\n      // of the SectionHeader component so it can be accessed here\n      const sectionData = sectionRefs.current[index]\n      const layout = sectionData?.layout\n\n      if (!layout)\n        return console.warn(`Section layout not correctly set`, sectionData)\n\n      // Update the is scrolling ref\n      // So other scrolling methods don't try to scroll\n      isScrollingRef.current = true\n\n      // Call the scroll method, to scroll to the section header based on it's layout\n      scrollList({\n        listRef,\n        animated: true,\n        behavior: 'smooth',\n        top: layout.top + scrollOffset,\n      })\n\n      // Call the passed in onSectionChange if it exists\n      checkCall(onSectionChange, index)\n\n      // Update the internal active section\n      setActiveSection(index)\n\n      // Wrap in a timeout to give it some cool down\n      // No way to track when scrolling stops, so this is the best we have\n      setTimeout(() => {\n        // Turn is scrolling back off\n        isScrollingRef.current = false\n      }, scrollCooldown)\n    },\n    [\n      scrollOffset,\n      scrollCooldown,\n      listRef.current,\n      onSectionChange,\n      setActiveSection,\n      sectionRefs.current,\n      isScrollingRef.current,\n    ]\n  )\n}\n\n/**\n * Displays a section header for each section, adding a view to helper with tracking\n * @param {Object} props\n * @param {number} props.index - Position of the section being rendered\n * @param {Object|function|node} props.renderSectionHeader - Callback passed from the consumer\n * @param {Object} props.sectionRefs - Ref Object to hold refs to the section header Dom Node\n * @param {Object} props.section - Current section being rendered\n * @param {Object} props.styles - Merged custom and theme styles\n * @param {function} props.onSectionChange - Callback called when a section is changed\n */\nconst SectionHeader = props => {\n  const {\n    index,\n    onSectionChange,\n    renderSectionHeader,\n    sectionRefs,\n    section,\n    styles,\n  } = props\n\n  const sectionRef = useRef(null)\n\n  useEffect(() => {\n    // If no onSectionChange method\n    // then we don't need to set the sectionRefs\n    if (!isFunc(onSectionChange)) return\n\n    sectionRefs.current[index] = sectionRef.current\n\n    sectionRefs.current[index].element &&\n      !sectionRefs.current[index].layout &&\n      (sectionRefs.current[index].layout = getElementLayout(\n        sectionRef.current.element\n      ))\n\n    return () => delete sectionRefs.current[index]\n  }, [ sectionRef.current, index, onSectionChange ])\n\n  // Wrap the renderSectionHeader method\n  // With a fragment, and view so we can track the section headers\n  // with an internal component and ref\n  return (\n    <>\n      <View\n        className={`keg-section-${index}`}\n        ref={element => (sectionRef.current = { element, index })}\n      />\n      { checkCall(renderSectionHeader, { section, styles, onSectionChange }) }\n    </>\n  )\n}\n\n/**\n * Helper hook for the renderSectionHeader, that wraps our custom Section header in a callback\n * @param {function} renderSectionHeader - Consumers callback method to render their section headers\n * @param {function} onSectionChange - Consumers callback called whe a section is changed\n * @param {Object} sectionRefs - React ref of all Section divider components.\n * @param {Object} styles - Merged custom and theme styles\n *\n * @returns {function} - Render function for Section Headers\n */\nconst useRenderSectionHeader = (\n  renderSectionHeader,\n  onSectionChange,\n  sectionRefs,\n  styles\n) => {\n  // This gets used by the renderSectionHeader prop\n  // It's not an issue with hooks, because the Callback hook\n  // Has already been called before is passed as prop to the SectionList component\n  // Which means we can call hooks in sub components\n  return useCallback(\n    ({ section }) => {\n      return (\n        <SectionHeader\n          index={section.__kegIndex}\n          renderSectionHeader={renderSectionHeader}\n          onSectionChange={onSectionChange}\n          section={section}\n          sectionRefs={sectionRefs}\n          styles={styles}\n        />\n      )\n    },\n    [ styles, onSectionChange, sectionRefs.current, renderSectionHeader ]\n  )\n}\n\nconst useRenderItem = (renderItem, onSectionChange) => {\n  return useCallback(\n    ({ item }) => {\n      return checkCall(renderItem, { item, onSectionChange })\n    },\n    [ renderItem, onSectionChange ]\n  )\n}\n\n/**\n * SectionList\n * @summary Default view component that wraps the React Native View component. All props are optional\n *\n * @param {Object} props - see SectionList PropTypes\n * @property {String} props.className - Value to set the className to (web platform only)\n * @property {String} props.innerClassName - Value to set the innerClassName to (web platform only)\n *\n */\nexport const SectionList = React.forwardRef((props, ref) => {\n  const {\n    activeSection: initialSection,\n    className,\n    innerClassName,\n    indexSectionHeaderBy,\n    noSectionHeaderScroll,\n    scrollCooldown = 2000,\n    onScrollSectionChange,\n    onSectionChange,\n    renderListHeader,\n    renderSectionHeader,\n    renderItem,\n    sectionChangeOffset = 10,\n    sections = noPropArr,\n    styles = noPropObj,\n    themePath,\n    type = 'default',\n    ...args\n  } = props\n\n  const sectionRefs = useRef({})\n  const isScrollingRef = useRef(false)\n  const listRef = ref || createRef()\n  const safeClassRef = useClassName('keg-safearea-list', className)\n  const classRef = useScrollClassName(\n    `keg-sectionlist`,\n    className,\n    innerClassName,\n    listRef\n  )\n\n  const listStyles = useThemePath(themePath || `list.section.${type}`, styles)\n  const indexedSections = useIndexedSections(sections, indexSectionHeaderBy)\n  const [ activeSection, setActiveSection ] = useState(\n    initialSection || get(indexedSections, '0.__kegIndex')\n  )\n\n  const [ sectionsContent, setSectionsContent ] = useState(sections)\n\n  useEffect(() => {\n    if (sections === sectionsContent) return\n    // if the section contents changes without scrolling,\n    // we want to make sure we update the activeSection accordingly\n    const scrollUpdate = {\n      scrollY: window.pageYOffset,\n    }\n    calculateActiveSection({\n      onScrollSectionChange,\n      sectionChangeOffset,\n      activeSection,\n      setActiveSection,\n      sectionRefs,\n      isScrollingRef,\n      scrollUpdate,\n    })\n\n    setSectionsContent(sections)\n  }, [\n    sections,\n    onScrollSectionChange,\n    sectionChangeOffset,\n    activeSection,\n    setActiveSection,\n    sectionRefs,\n    isScrollingRef,\n  ])\n\n  const onSectionChangeAction = useSectionChange(\n    noSectionHeaderScroll !== true,\n    onSectionChange,\n    sectionChangeOffset,\n    setActiveSection,\n    sectionRefs,\n    listRef,\n    isScrollingRef,\n    scrollCooldown\n  )\n  const onRenderItem = useRenderItem(renderItem, onSectionChangeAction)\n  const onSectionHeaderRender = useRenderSectionHeader(\n    renderSectionHeader,\n    onSectionChangeAction,\n    sectionRefs,\n    listStyles\n  )\n\n  useSectionChangeOnScroll(\n    onScrollSectionChange,\n    sectionChangeOffset,\n    activeSection,\n    setActiveSection,\n    sectionRefs,\n    isScrollingRef\n  )\n\n  return (\n    <View\n      className='keg-sectionlist-container'\n      style={listStyles?.main}\n    >\n      { renderListHeader &&\n        renderFromType(\n          renderListHeader,\n          {\n            ...props,\n            styles: listStyles,\n            onSectionChange: onSectionChangeAction,\n          },\n          Text\n        ) }\n      <SafeAreaView\n        ref={safeClassRef}\n        style={listStyles?.content.list}\n      >\n        <RNSectionList\n          {...args}\n          ref={classRef}\n          renderItem={onRenderItem}\n          sections={indexedSections}\n          renderSectionHeader={onSectionHeaderRender}\n        />\n      </SafeAreaView>\n    </View>\n  )\n})\n\nSectionList.propTypes = {\n  ...RNSectionList.propTypes,\n  activeSection: PropTypes.oneOfType([ PropTypes.string, PropTypes.number ]),\n  className: PropTypes.oneOfType([ PropTypes.string, PropTypes.array ]),\n  /**\n   * Property on each section used to index each section header\n   */\n  indexSectionHeaderBy: PropTypes.string,\n  innerClassName: PropTypes.oneOfType([ PropTypes.string, PropTypes.array ]),\n  noSectionHeaderScroll: PropTypes.bool,\n  /**\n   * Called when a section becomes active ( visible ) from scrolling\n   */\n  onScrollSectionChange: PropTypes.func,\n  /**\n   * Called when a section changes either through scrolling or programmatically\n   * Is NOT called when onScrollSectionChange prop exists, and section is changed from scrolling\n   */\n  onSectionChange: PropTypes.func,\n  scrollCooldown: PropTypes.number,\n  /**\n   * Render prop to render the list header\n   */\n  renderListHeader: PropTypes.oneOfType([ PropTypes.node, PropTypes.func ]),\n  /**\n   * Render prop to render the header of each section\n   */\n  renderSectionHeader: PropTypes.oneOfType([ PropTypes.node, PropTypes.func ]),\n  /**\n   * Render prop to render each item in each section\n   */\n  renderItem: PropTypes.oneOfType([ PropTypes.node, PropTypes.func ]),\n  /**\n   * Offset the scroll position by some amount (px) when section header scrolling is enabled\n   */\n  sectionChangeOffset: PropTypes.number,\n  sections: PropTypes.array,\n  styles: PropTypes.object,\n  themePath: PropTypes.string,\n  type: PropTypes.string,\n}\n"],"names":["defLayout","top","left","getElementLayout","scrollList","listRef","animated","current","scrollTo","exists","y","x","defPos","scrollX","scrollY","useScroll","useIndexedSections","sections","indexBy","useMemo","map","section","index","__kegIndex","get","useSectionChangeOnScroll","onScrollSectionChange","sectionChangeOffset","activeSection","setActiveSection","sectionRefs","isScrollingRef","useCallback","__","scrollUpdate","calculateActiveSection","props","scrollLoc","currentSection","Object","entries","reduce","foundSection","sectionData","checkTop","layout","foundTop","checkCall","useSectionChange","doScrolling","onSectionChange","scrollOffset","scrollCooldown","console","warn","behavior","setTimeout","SectionHeader","renderSectionHeader","styles","sectionRef","useRef","useEffect","isFunc","element","React","View","useRenderSectionHeader","useRenderItem","renderItem","item","SectionList","forwardRef","ref","initialSection","className","innerClassName","indexSectionHeaderBy","noSectionHeaderScroll","renderListHeader","noPropArr","noPropObj","themePath","type","args","createRef","safeClassRef","useClassName","classRef","useScrollClassName","listStyles","useThemePath","indexedSections","useState","sectionsContent","setSectionsContent","window","pageYOffset","onSectionChangeAction","onRenderItem","onSectionHeaderRender","main","renderFromType","Text","SafeAreaView","content","list","RNSectionList"],"mappings":"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"}