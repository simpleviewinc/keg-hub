{"version":3,"file":"modal.js","sources":["../../../src/components/modal/modal.js"],"sourcesContent":["import React, { useEffect, useState, useCallback } from 'react'\nimport { Animated, Dimensions } from 'react-native'\nimport { Touchable } from '../touchable'\nimport PropTypes from 'prop-types'\nimport { useThemePath, useFromToAnimation } from 'KegHooks'\nimport { View } from 'KegView'\nimport { isFunc } from '@keg-hub/jsutils'\nimport { noOp } from '@keg-hub/jsutils'\nimport { useClassName } from 'KegClassName'\nimport { useClassList } from 'KegClassList'\n\n/**\n * Default Slide animated View for modal\n * @param {Object} props\n * @param {Object=} props.defaultStyle - default style coming from theme\n * @param {Boolean} props.visible - if true, show the modal, else hide it\n * @param {Component} props.children - the component(s) to render inside the modal\n * @param {Function=} props.onAnimationFinish - the function to execute when the an animation is complete\n */\nconst SlideAnimatedView = ({\n  className,\n  defaultStyle,\n  visible,\n  children,\n  onAnimationFinish,\n}) => {\n  // setup anim value to start/end offscreen\n  const windowHeight = Dimensions.get('window').height\n  const bottomOfScreen = windowHeight\n  const origin = 0\n\n  const [slide] = useFromToAnimation({\n    from: visible ? bottomOfScreen : origin,\n    to: visible ? origin : bottomOfScreen,\n    onFinish: onAnimationFinish,\n  })\n\n  const classRef = useClassName('keg-modal-content', className)\n\n  return (\n    <Animated.View\n      ref={classRef}\n      style={{ ...defaultStyle, transform: [{ translateY: slide }] }}\n    >\n      { children }\n    </Animated.View>\n  )\n}\n\nconst hideModalStyle = { height: 0, width: 0, overflow: 'hidden' }\n\n/**\n * Simple popup modal using fixed positioning.\n * @param {Object} props\n * @param {Boolean} props.visible - if true, show the modal, else hide it\n * @param {Object=} props.styles - styles object which overrides default theme styles\n * @param {Function=} props.onBackdropTouch - the function to execute when the user selects/touches outside the modal; defaults to noOp\n * @param {Function=} props.onAnimateIn - the function to execute when animation on visible is done\n * @param {Function=} props.onAnimateOut - the function to execute when animation on not visible is done\n * @param {Component} props.children - the component(s) to render inside the modal\n * @param {String=} props.themePath\n * @param {String=} props.type - type of modal (points to styles in theme file with that type); default is 'default'\n * @param {Number=} props.activeOpacity - changes opacity of background when touched/clicked; default is 1\n * @param {Component=} props.AnimatedComponent - Custom animated component if you want to override our default animations\n */\nexport const Modal = props => {\n  const {\n    AnimatedComponent = SlideAnimatedView,\n    activeOpacity = 1,\n    children,\n    className,\n    onAnimateIn,\n    onAnimateOut,\n    onBackdropTouch = noOp,\n    styles,\n    themePath,\n    type = 'default',\n    visible,\n  } = props\n\n  const [ renderModal, setRenderModal ] = useState(false)\n  if (props.visible && !renderModal) setRenderModal(true)\n  const modalStyles = useThemePath(themePath || `modal.${type}`, styles)\n\n  useEffect(() => {\n    if (global.document && visible) {\n      // lock scrolling on web if a modal exists\n      global.document.body.style.overflow = 'hidden'\n      // enable scrolling when unmounted\n      return () => {\n        global.document.body.style.overflow = ''\n      }\n    }\n  }, [visible])\n\n  // animation callback\n  // we change the wrapper dimensions to 0 AFTER animationOut finishes\n  const cb = useCallback(() => {\n    if (!visible) {\n      setRenderModal(false)\n      if (isFunc(onAnimateOut)) onAnimateOut()\n    }\n    else if (isFunc(onAnimateIn)) onAnimateIn()\n  }, [ onAnimateOut, onAnimateIn, visible ])\n\n  return (\n    // change the wrapper dimensions to 0 when visible is set to false\n    <View\n      className={useClassList('keg-modal', className)}\n      style={renderModal ? modalStyles.main : hideModalStyle}\n    >\n      <Touchable\n        className={'keg-modal-backdrop'}\n        style={modalStyles.backdrop}\n        onPress={onBackdropTouch}\n        activeOpacity={activeOpacity}\n      />\n      <AnimatedComponent\n        onAnimationFinish={cb}\n        visible={visible}\n        defaultStyle={modalStyles.content}\n      >\n        { children }\n      </AnimatedComponent>\n    </View>\n  )\n}\n\nModal.propTypes = {\n  themePath: PropTypes.string,\n  type: PropTypes.string,\n  visible: PropTypes.bool,\n  styles: PropTypes.object,\n  activeOpacity: PropTypes.number,\n  onBackdropTouch: PropTypes.func,\n  onAnimateIn: PropTypes.func,\n  onAnimateOut: PropTypes.func,\n  AnimatedComponent: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.elementType,\n  ]),\n}\n"],"names":["SlideAnimatedView","className","defaultStyle","visible","children","onAnimationFinish","windowHeight","Dimensions","get","height","bottomOfScreen","origin","useFromToAnimation","from","to","onFinish","slide","classRef","useClassName","React","Animated","transform","translateY","hideModalStyle","width","overflow","Modal","props","AnimatedComponent","activeOpacity","onAnimateIn","onAnimateOut","onBackdropTouch","noOp","styles","themePath","type","useState","renderModal","setRenderModal","modalStyles","useThemePath","useEffect","global","document","body","style","cb","useCallback","isFunc","View","useClassList","main","Touchable","backdrop","content"],"mappings":"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"}