{"version":3,"file":"image.js","sources":["../../../src/components/image/image.js"],"sourcesContent":["import { View } from 'KegView'\nimport PropTypes from 'prop-types'\nimport { Loading } from '../loading'\nimport { checkCall, isFunc } from '@keg-hub/jsutils'\nimport { Image as InternalImage } from '../internal/image'\nimport { useThemeHover, useStyle } from '@keg-hub/re-theme'\nimport { useThemePath } from 'KegHooks'\nimport React, { useState, forwardRef, useRef, useCallback } from 'react'\nimport { useClassList } from 'KegClassList'\nimport { getImgSrc, getPressHandler } from 'KegUtils'\nimport { StyleInjector } from '@keg-hub/re-theme/styleInjector'\n\nconst KegImage = StyleInjector(InternalImage, {\n  displayName: 'Image',\n  className: 'keg-image',\n})\n\n/**\n * Image\n * @summary Custom image wrapper component. All props are optional\n *\n * @param {Object} props - see buttonPropTypes\n * @property {string} props.alt - Alternate text when image fails to load\n * @property {Function} props.onPress - function to do when image is pressed\n * @property {String} props.src - Source url of the image\n * @property {Object} props.style - custom style\n * @property {string} props.type - image type\n * @property {Boolean} props.useLoading - (defaults true) if true, show a loading spinner for remote sources until they load\n *\n */\nexport const Image = forwardRef((props, ref) => {\n  const [ loading, setLoading ] = useState(true)\n  const internalRef = ref || useRef(null)\n\n  const {\n    alt,\n    className,\n    children,\n    onClick,\n    onPress,\n    src,\n    source,\n    styles,\n    type = 'default',\n    themePath = `image.${type}`,\n    useLoading = true,\n    ...attrs\n  } = props\n\n  const builtStyles = useThemePath(themePath, styles)\n  const loadingStyles = useStyle(builtStyles.loading, builtStyles.image)\n  const loadedStyles = useStyle(loadingStyles, builtStyles.loaded)\n\n  const [ imgRef, elementStyle, setStyle ] = useThemeHover(\n    loadedStyles,\n    builtStyles.hover,\n    { internalRef }\n  )\n\n  // Listen for updates to the image loading\n  const onLoad = useCallback(() => {\n    // Update state that the image is loaded\n    checkCall(setLoading, false)\n    // Update the style to use for the loaded image - So we can see it\n    checkCall(setStyle, elementStyle)\n    // Call onLoad in props if it exists\n    checkCall(props.onLoad, props)\n    // Call the imgRef function or set it if it exists\n    isFunc(imgRef)\n      ? imgRef(internalRef.current)\n      : imgRef && (imgRef.current = internalRef.current)\n  }, [ src, source, internalRef.current ])\n\n  return (\n    <View\n      className={useClassList(`keg-image-container`, className)}\n      style={builtStyles.container}\n    >\n      { loading && useLoading && (\n        <Loading\n          className='keg-image-loading'\n          styles={builtStyles.loadingComp}\n        />\n      ) }\n      <KegImage\n        {...attrs}\n        style={loading ? loadingStyles : builtStyles.image}\n        {...getPressHandler(false, onClick, onPress)}\n        {...getImgSrc(false, src, source)}\n        onLoadEnd={onLoad}\n        alt={alt}\n        ref={internalRef}\n      />\n    </View>\n  )\n})\n\nImage.propTypes = {\n  ...InternalImage.propTypes,\n  onPress: PropTypes.func,\n  type: PropTypes.string,\n  alt: PropTypes.string,\n  src: PropTypes.oneOfType([ PropTypes.string, PropTypes.object ]),\n  styles: PropTypes.object,\n}\n"],"names":["KegImage","StyleInjector","InternalImage","displayName","className","Image","forwardRef","props","ref","useState","loading","setLoading","internalRef","useRef","alt","children","onClick","onPress","src","source","styles","type","themePath","useLoading","attrs","builtStyles","useThemePath","loadingStyles","useStyle","image","loadedStyles","loaded","useThemeHover","hover","imgRef","elementStyle","setStyle","onLoad","useCallback","checkCall","isFunc","current","React","useClassList","container","loadingComp","getPressHandler","getImgSrc"],"mappings":"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"}