{"version":3,"file":"modal.js","sources":["../../../src/components/modal/modal.js"],"sourcesContent":["import React, { useEffect, useState, useCallback } from 'react'\nimport { Animated, Dimensions } from 'react-native'\nimport { Touchable } from '../touchable'\nimport PropTypes from 'prop-types'\nimport { useThemePath, useFromToAnimation } from 'KegHooks'\nimport { View } from 'KegView'\nimport { isFunc } from '@keg-hub/jsutils'\nimport { noOp } from '@keg-hub/jsutils'\nimport { useClassName } from 'KegClassName'\nimport { useClassList } from 'KegClassList'\n\n/**\n * Default Slide animated View for modal\n * @param {Object} props\n * @param {Object=} props.defaultStyle - default style coming from theme\n * @param {Boolean} props.visible - if true, show the modal, else hide it\n * @param {Component} props.children - the component(s) to render inside the modal\n * @param {Function=} props.onAnimationFinish - the function to execute when the an animation is complete\n */\nconst SlideAnimatedView = ({\n  className,\n  defaultStyle,\n  visible,\n  children,\n  onAnimationFinish,\n}) => {\n  // setup anim value to start/end offscreen\n  const windowHeight = Dimensions.get('window').height\n  const bottomOfScreen = windowHeight\n  const origin = 0\n\n  const [slide] = useFromToAnimation({\n    from: visible ? bottomOfScreen : origin,\n    to: visible ? origin : bottomOfScreen,\n    onFinish: onAnimationFinish,\n  })\n\n  const classRef = useClassName('keg-modal-content', className)\n\n  return (\n    <Animated.View\n      ref={classRef}\n      style={{ ...defaultStyle, transform: [{ translateY: slide }] }}\n    >\n      { children }\n    </Animated.View>\n  )\n}\n\nconst hideModalStyle = { height: 0, width: 0, overflow: 'hidden' }\n\n/**\n * Simple popup modal using fixed positioning.\n * @param {Object} props\n * @param {Boolean} props.visible - if true, show the modal, else hide it\n * @param {Object=} props.styles - styles object which overrides default theme styles\n * @param {Function=} props.onBackdropTouch - the function to execute when the user selects/touches outside the modal; defaults to noOp\n * @param {Function=} props.onAnimateIn - the function to execute when animation on visible is done\n * @param {Function=} props.onAnimateOut - the function to execute when animation on not visible is done\n * @param {Component} props.children - the component(s) to render inside the modal\n * @param {String=} props.themePath\n * @param {String=} props.type - type of modal (points to styles in theme file with that type); default is 'default'\n * @param {Number=} props.activeOpacity - changes opacity of background when touched/clicked; default is 1\n * @param {Component=} props.AnimatedComponent - Custom animated component if you want to override our default animations\n */\nexport const Modal = props => {\n  const {\n    AnimatedComponent = SlideAnimatedView,\n    activeOpacity = 1,\n    children,\n    className,\n    onAnimateIn,\n    onAnimateOut,\n    onBackdropTouch = noOp,\n    styles,\n    themePath,\n    type = 'default',\n    visible,\n  } = props\n\n  const [ renderModal, setRenderModal ] = useState(false)\n  if (props.visible && !renderModal) setRenderModal(true)\n  const modalStyles = useThemePath(themePath || `modal.${type}`, styles)\n\n  useEffect(() => {\n    if (global.document && visible) {\n      // lock scrolling on web if a modal exists\n      global.document.body.style.overflow = 'hidden'\n      // enable scrolling when unmounted\n      return () => {\n        global.document.body.style.overflow = ''\n      }\n    }\n  }, [visible])\n\n  // animation callback\n  // we change the wrapper dimensions to 0 AFTER animationOut finishes\n  const cb = useCallback(() => {\n    if (!visible) {\n      setRenderModal(false)\n      if (isFunc(onAnimateOut)) onAnimateOut()\n    }\n    else if (isFunc(onAnimateIn)) onAnimateIn()\n  }, [ onAnimateOut, onAnimateIn, visible ])\n\n  return (\n    // change the wrapper dimensions to 0 when visible is set to false\n    <View\n      className={useClassList('keg-modal', className)}\n      style={renderModal ? modalStyles.main : hideModalStyle}\n    >\n      <Touchable\n        className={'keg-modal-backdrop'}\n        style={modalStyles.backdrop}\n        onPress={onBackdropTouch}\n        activeOpacity={activeOpacity}\n      />\n      <AnimatedComponent\n        onAnimationFinish={cb}\n        visible={visible}\n        defaultStyle={modalStyles.content}\n      >\n        { children }\n      </AnimatedComponent>\n    </View>\n  )\n}\n\nModal.propTypes = {\n  themePath: PropTypes.string,\n  type: PropTypes.string,\n  visible: PropTypes.bool,\n  styles: PropTypes.object,\n  activeOpacity: PropTypes.number,\n  onBackdropTouch: PropTypes.func,\n  onAnimateIn: PropTypes.func,\n  onAnimateOut: PropTypes.func,\n  AnimatedComponent: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.elementType,\n  ]),\n}\n"],"names":["SlideAnimatedView","className","defaultStyle","visible","children","onAnimationFinish","windowHeight","Dimensions","get","height","bottomOfScreen","origin","useFromToAnimation","from","to","onFinish","slide","classRef","useClassName","React","transform","translateY","hideModalStyle","width","overflow","Modal","props","AnimatedComponent","activeOpacity","onAnimateIn","onAnimateOut","onBackdropTouch","noOp","styles","themePath","type","useState","renderModal","setRenderModal","modalStyles","useThemePath","useEffect","global","document","body","style","cb","useCallback","isFunc","useClassList","main","backdrop","content"],"mappings":"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"}