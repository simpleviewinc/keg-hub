{"version":3,"file":"drawer.js","sources":["../../../src/components/drawer/drawer.js"],"sourcesContent":["import { View } from '../view'\nimport PropTypes from 'prop-types'\nimport { get } from '@keg-hub/jsutils'\nimport { useThemePath } from '../../hooks'\nimport { noOpObj } from '@keg-hub/jsutils'\nimport { Animated } from 'react-native'\nimport { useClassName } from 'KegClassName'\nimport React, { useState, useLayoutEffect, useCallback, useRef } from 'react'\nimport { isValidComponent } from '../../utils/validate/isValidComponent'\nimport { getPlatform } from 'KegGetPlatform'\nconst isWeb = getPlatform() === 'web'\n\n/**\n * Checks if the animation should NOT run\n * @param {boolean} toggled - Current state of the Drawer toggled open\n * @param {number} current - Current height of the Drawer / animated.value\n * @param {number} contentMaxHeight\n * @param {number} collapsedHeight\n *\n * @returns {boolean} - If the animation should NOT run\n */\nconst noAnimate = (toggled, current, collapsedHeight, contentMaxHeight) =>\n  (!toggled && current === collapsedHeight) ||\n  (toggled && current === contentMaxHeight)\n\n/**\n * Drawer\n * @param {Object} props - props passed from parent component\n * @param {Function|Component} props.children - Child components placed inside the drawer\n * @param {Number=} props.collapsedHeight - optional. height of the collapsed view\n * @param {string=} props.className\n * @param {Function|Component} props.Element - Child Element of the Drawer. Overrides the default children prop\n * @param {string} props.type - Animation type from the Animated API that accepts an animated config\n * @param {Object} props.config - Animation config object passed on to the Animated type method\n * @param {Object} props.styles - Custom styles to applied to the slider\n * @param {boolean} props.toggled - Is the slider toggled open\n * @param {boolean} props.* - All other props passed on to the Element Component prop if it exists\n *\n * @returns {Component} - Drawer Component\n */\nexport const Drawer = React.forwardRef((props, ref) => {\n  const {\n    Element,\n    styles,\n    toggled,\n    className,\n    type = 'timing',\n    config = noOpObj,\n    collapsedHeight = 0,\n    ...childProps\n  } = props\n\n  // Define the default max height as a ref\n  const contentMaxHeight = useRef(null)\n\n  // Define the animated value as a ref\n  const [ animation, setAnimation ] = useState(\n    new Animated.Value(collapsedHeight)\n  )\n\n  // Define a helper to update the total max height of the slider\n  // Gets called from the onLayout callback of the View wrapper\n  const setMaxHeight = useCallback(\n    event => {\n      const maxHeight = event.nativeEvent.layout.height\n      if (contentMaxHeight.current === maxHeight) return\n\n      contentMaxHeight.current = maxHeight\n      toggled && setAnimation(new Animated.Value(maxHeight))\n    },\n    [ contentMaxHeight, toggled, setAnimation ]\n  )\n\n  // Use useLayoutEffect to check if the slider should be animated\n  // Within the hook, toggled flag defines how to update the animated value\n  // To Open: toggled === true === should animate open\n  // To Close: toggled === false === should animate close\n  useLayoutEffect(() => {\n    // Check if we should animate the slider\n    // If the values have not changed, no need to animate\n    if (\n      noAnimate(\n        toggled,\n        animation._value,\n        collapsedHeight,\n        contentMaxHeight.current\n      )\n    )\n      return\n\n    // Define the from and to values for the animation based on toggled flag\n    const heightChanges = toggled\n      ? { from: collapsedHeight, to: contentMaxHeight.current }\n      : { from: contentMaxHeight.current, to: collapsedHeight }\n\n    // Update the animation value to animate from\n    animation.setValue(heightChanges.from)\n    // Start the animation, from value ==> to value\n    const animationConfig = config\n      ? { ...config, toValue: heightChanges.to }\n      : { toValue: heightChanges.to }\n\n    // If on web, then don't use the animated driver\n    animationConfig.useNativeDriver = !isWeb\n    Animated[type](animation, animationConfig).start()\n\n    // Add toggled as a dep, so anytime it changes, we run the hook code\n  }, [ toggled, type, config, collapsedHeight ])\n\n  const drawerStyles = useThemePath(`drawer`, styles)\n  const classRef = useClassName('keg-drawer', className, ref)\n\n  return (\n    <Animated.View\n      ref={classRef}\n      style={[ drawerStyles.main, get(styles, 'main'), { maxHeight: animation }]}\n    >\n      <View\n        className='keg-drawer-content'\n        onLayout={setMaxHeight}\n        style={get(styles, 'content')}\n      >\n        { isValidComponent(Element) ? (\n          <Element\n            {...childProps}\n            styles={styles}\n          />\n        ) : (\n          props.children\n        ) }\n      </View>\n    </Animated.View>\n  )\n})\n\nDrawer.propTypes = {\n  className: PropTypes.oneOfType([ PropTypes.array, PropTypes.string ]),\n  config: PropTypes.object,\n  Element: PropTypes.oneOfType([ PropTypes.func, PropTypes.elementType ]),\n  styles: PropTypes.oneOfType([ PropTypes.object, PropTypes.array ]),\n  toggled: PropTypes.bool,\n  type: PropTypes.oneOf([ 'decay', 'spring', 'timing' ]),\n  collapsedHeight: PropTypes.number,\n}\n"],"names":["isWeb","getPlatform","noAnimate","toggled","current","collapsedHeight","contentMaxHeight","Drawer","React","forwardRef","props","ref","Element","styles","className","type","config","noOpObj","childProps","useRef","useState","Animated","Value","animation","setAnimation","setMaxHeight","useCallback","event","maxHeight","nativeEvent","layout","height","useLayoutEffect","_value","heightChanges","from","to","setValue","animationConfig","toValue","useNativeDriver","start","drawerStyles","useThemePath","classRef","useClassName","main","get","isValidComponent","children"],"mappings":"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"}