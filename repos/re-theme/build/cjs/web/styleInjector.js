"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("@keg-hub/jsutils"),r=require("./useTheme-f0ffcb5c.js"),n=require("react"),o=_interopDefault(n),i=_interopDefault(require("react-native-web/dist/modules/prefixStyles")),a=_interopDefault(require("react-native-web/dist/modules/flattenArray")),c=_interopDefault(require("react-native-web/dist/exports/StyleSheet/flattenStyle")),s=_interopDefault(require("react-native-web/dist/exports/StyleSheet/createReactDOMStyle")),l=_interopDefault(require("react-native-web/dist/exports/StyleSheet/createCompileableStyle")),u={important:[],filter:["aspectRatio","elevation","overlayColor","resizeMode","tintColor","backgroundSize","animationKeyframes","placeholderTextColor","pointerEvents","scrollbarWidth"]},f=r.hasDomAccess(),d=new Set,getKegSheet=function(){return e=e||document.head.querySelector(r.Constants.KEG_STYLES_TAG_ID)},p=/[A-Z]/g,v=/^ms-/,h={},toHyphenLower=function(e){return"-"+e.toLowerCase()},getSelector=function(e,r,n){var filterWithPrefix=function(e){return e&&n?e.startsWith(n):e},o=!!t.exists(e)&&(t.isArr(e)?e.filter(filterWithPrefix).pop():t.isStr(e)&&e.split(" ").filter(filterWithPrefix).pop()),i="keg-".concat(function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!t.isStr(e)||0==e.length)return 0;e=e.split("").reverse().join("");for(var n=0,o=0;o<e.length;o++){var i=e.charCodeAt(o);n=(n<<5)-n+i,n="".concat(Math.abs(n&n))}return r?n.slice(0,r):n}(r));return{hashClass:i,selector:o?".".concat(o.trim(),".").concat(i).trim():".".concat(i).trim()}},addStylesToDom=function(e,t){if(f&&t&&!function(e){return d.has(e)}(e)){d.add(e);var r=getKegSheet();r.sheet.insertRule("@media all {".concat(t.all,"}"))}};r.addThemeEvent(r.Constants.BUILD_EVENT,(function(){d.clear(),getKegSheet().textContent=""})),function(){if(f){if(e=document.head.querySelector(r.Constants.KEG_STYLES_TAG_ID))return e;(e=document.createElement("style")).id=r.Constants.KEG_STYLES_TAG_ID,document.head.append(e)}}();var m=Object.freeze({}),createBlock=function(e,r){var n=u.important.concat(null==r?void 0:r.important),o=i(s(e)),a=Object.keys(o).map((function(e){var r=function(e,t,r){return r.includes(e)?"".concat(t," !important"):t}(e,o[e],n),i=function(e){if(h.hasOwnProperty(e))return h[e];var t=e.replace(p,toHyphenLower);return h[e]=v.test(t)?"-"+t:t}(e);return t.isArr(r)?r.map((function(e){return"".concat(i,":").concat(e)})).join(";"):"".concat(i,":").concat(r)})).sort().join(";");return"{".concat(a,"}")},convertToCss=function(e,r){return a(t.eitherArr(e,[e])).reduce((function(e,n){if(!t.isObj(n))return e;var o=function(e,r){var n=t.isArr(r)?u.filter.concat(r):u.filter;return{style:t.omitKeys(e,n),filtered:t.pickKeys(e,n)}}(n,null==r?void 0:r.filter),i=o.style,a=o.filtered;Object.assign(e.filtered,a);var s=c(i),f=l(s);return e.blocks.push(createBlock(f,r)),e}),{blocks:[],filtered:{}})},useStyleTag=function(e){var o,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=arguments.length>2?arguments[2]:void 0;c=t.isObj(c)?c:m;var s=r.useTheme(),l=null==s||null===(o=s.RTMeta)||void 0===o?void 0:o.size,u=null==s||null===(i=s.RTMeta)||void 0===i?void 0:i.key;return n.useMemo((function(){var r=convertToCss(e,c),n=r.blocks,o=r.filtered,i=getSelector(a,n.join(""),"keg"),s=i.hashClass,l=i.selector,u=n.reduce((function(e,t){var r="".concat(l).concat(t);return e.all+=r,e.rules.push(r),e}),{all:"",rules:[]});return addStylesToDom(l,u),{css:u,filteredStyle:o,classList:t.eitherArr(a,[a]).concat([s])}}),[e,a,l,u,c])},y=o.forwardRef((function(e,t){var n=e.Component,i=e.children,a=e.config,c=e.className,s=e.style,l=r._objectWithoutProperties(e,["Component","children","config","className","style"]),u=a.className,f=useStyleTag(s,c||u,a),d=f.classList,p=f.filteredStyle;return o.createElement(n,r._extends({},l,{style:p,ref:t,className:d}),i)}));exports.StyleInjector=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o.forwardRef((function(n,i){var a=n.style,c=r._objectWithoutProperties(n,["style"]);return a?o.createElement(y,r._extends({},c,{style:a,config:t,Component:e,ref:i})):o.createElement(e,r._extends({},c,{style:a,ref:i}))}))},exports.convertToCss=convertToCss,exports.createBlock=createBlock,exports.useStyleTag=useStyleTag;
//# sourceMappingURL=styleInjector.js.map
