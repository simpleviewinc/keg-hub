{"version":3,"file":"head.js","sources":["../../../src/head/headElement.js","../../../src/head/headComponents.js","../../../src/head/headProvider.js","../../../src/head/reThemeHeadProvider.js"],"sourcesContent":["import React, { Component, useEffect, useRef } from 'react'\nimport * as ReactDOM from 'react-dom'\nimport { Consumer } from './headContext'\nimport { hasDomAccess } from '../helpers/hasDomAccess'\n\nconst canUseDOM = hasDomAccess()\n\n/**\n * HeadElement - sub-component of the HeadProvider, which consumes it's context\n * <br/>This allows it to check if it should render or not based on it a duplicate already exists\n * @param {object} props\n * @param {object} props.tag - Dom Element tag name\n * @param {string} props.style - Overrides children when props.tag === style\n * @param {string} props.id - Id attribute to be applied to the component\n * @param {string} props.tagProps - Extra props to pass to the Dom Element on render\n */\nexport const HeadElement = props => {\n\n  const { tag: Tag, style, id, ...tagProps } = props\n  const { name, property } = tagProps\n\n  const indexRef = useRef(-1)\n  const headTagsRef = useRef(null)\n  const children = (Tag === 'style' && style) || props.children\n\n  useEffect(() => {\n    indexRef.current = headTagsRef.current.addTag(Tag, id)\n\n    return () => {\n      headTagsRef.current.removeTag(Tag, indexRef.current, id)\n    }\n\n  }, [ Tag, name, property, style ])\n\n  return (\n    <Consumer>\n      {headTags => {\n        headTagsRef.current = headTags\n\n        return canUseDOM &&\n          headTags.shouldRender(Tag, indexRef.current, id) &&\n          ReactDOM.createPortal(\n            <Tag {...tagProps} id={id} children={ children } />,\n            document.head\n          )\n\n      }}\n    </Consumer>\n  )\n\n}\n","import React from 'react'\nimport { HeadElement } from './headElement'\n\nexport const Title = props => (<HeadElement tag=\"title\" {...props} />)\n\nexport const Style = props => (<HeadElement tag=\"style\" {...props} />)\n\nexport const Meta = props => (<HeadElement tag=\"meta\" {...props} />)\n\nexport const Link = props => (<HeadElement tag=\"link\" {...props} />)\n","import React, { Component } from 'react'\nimport { Provider } from './headContext'\nimport { hasDomAccess } from '../helpers/hasDomAccess'\nimport { isArr } from '@keg-hub/jsutils'\n\n/**\n * HeadProvider - Component used to apply styles to the Dom when on a web Platform\n */\nexport class HeadProvider extends Component {\n\n  ids = new Map()\n\n  canUseDOM = hasDomAccess()\n\n  state = {\n\n    /**\n     * Adds a tag to the array referenced by the passed in id\n     * @member HeadProvider.state\n     * @function\n     * @param {string} tag - Dom Element tag name that uses the styles of the passed in ID\n     * @param {string|number} id - Id of the styles tag to be added\n     * \n     * @returns {Object} Index of the newly added tag\n     */\n    addTag: (tag, id) => {\n      const tags = this.ids.get(id) || []\n      tags.push(tag)\n      this.ids.set(id, tags)\n\n      return tags.length - 1\n    },\n\n    /**\n     * Checks if the style tag should be rendered\n     * @member HeadProvider.state\n     * @function\n     * @param {string} tag - Dom Element tag name that uses the styles of the passed in ID\n     * @param {number} index - Location of the tag in the tags array\n     * @param {string|number} id - Id of the styles tag to be added\n     * \n     * @returns {Object} Index of the newly added tag\n     */\n    shouldRender: (tag, index, id) => {\n      return !this.state.enforceId(tag, id)\n    },\n\n    /**\n     * Removes a tag from the tags array\n     * @member HeadProvider.state\n     * @function\n     * @param {string} tag - Dom Element tag name that uses the styles of the passed in ID\n     * @param {number} index - Location of the tag in the tags array\n     * @param {string|number} id - Id of the styles tag to be removed\n     * \n     * @returns {void}\n     */\n    removeTag: (tag, index, id) => {\n      let tags = this.ids.get(id)\n      if(!isArr(tags)) return\n\n      index = index || tags.indexOf(tag)\n      tags = index >= -1 && tags.splice(index, 1)\n\n      !tags.length\n        ? this.ids.delete(id)\n        : this.ids.set(id, tags)\n    },\n\n    /**\n     * Checks if a hash exits as an id\n     * @member HeadProvider.state\n     * @function\n     * @param {string} hash - randomized string representation of a styles object\n     * \n     * @returns {boolean} - True if the hash exists\n     */\n    hasHash: hash => {\n      const tags = this.ids.get(hash)\n      return Boolean(tags && tags.length)\n    },\n\n    /**\n     * Checks if a tag is in an array tied to an id\n     * <br/>If it's not then it will create the id in the Map pointing to an array containing the tag\n     * @member HeadProvider.state\n     * @function\n     * @param {string} tag - Dom Element tag name that uses the styles of the passed in ID\n     * @param {string|number} id - Id of the styles tag to be removed\n     * \n     * @returns {void}\n     */\n    enforceId: (tag, id) => {\n      const tags = this.ids.get(id) || []\n\n      if(tags.includes(tag)) return id\n\n      // Have to add the tag here, otherwise other components\n      // that use the same Id will not know it's already been registered\n      this.state.addTag(tag, id)\n\n      return false\n    }\n  }\n\n  render() {\n    return this.canUseDOM && (\n      <Provider value={this.state}>\n        {this.props.children}\n      </Provider>\n    )\n  }\n}\n","import React from 'react'\nimport { ReThemeProvider } from '../context/reThemeProvider'\nimport { HeadProvider } from './headProvider'\n\nexport const ReThemeHeadProvider = props => {\n  return (\n    <ReThemeProvider {...props} >\n      <HeadProvider>\n        { props.children }\n      </HeadProvider>\n    </ReThemeProvider>\n  )\n}\n"],"names":["canUseDOM","hasDomAccess","HeadElement","props","Tag","tag","style","id","tagProps","name","property","indexRef","useRef","headTagsRef","children","useEffect","current","addTag","removeTag","React","Consumer","headTags","shouldRender","ReactDOM","document","head","Title","Style","Meta","Link","HeadProvider","ids","Map","state","tags","get","push","set","length","index","enforceId","isArr","indexOf","splice","hasHash","hash","Boolean","includes","Provider","Component","ReThemeHeadProvider","ReThemeProvider"],"mappings":"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"}