import{omitKeys as e,pickKeys as t,isArr as r,exists as n,isStr as o,eitherArr as a,isObj as i}from"@keg-hub/jsutils";import{m as c,C as l,h as s,u,p as f,a as d}from"./useTheme-d0a4d31a.js";import m,{useMemo as p}from"react";import v from"react-native-web/dist/modules/prefixStyles";import h from"react-native-web/dist/modules/flattenArray";import y from"react-native-web/dist/exports/StyleSheet/flattenStyle";import S from"react-native-web/dist/exports/StyleSheet/createReactDOMStyle";import b from"react-native-web/dist/exports/StyleSheet/createCompileableStyle";var g,C={important:[],filter:["aspectRatio","elevation","overlayColor","resizeMode","tintColor","backgroundSize","animationKeyframes","placeholderTextColor","pointerEvents","scrollbarWidth"]},E=s(),T=new Set,getKegSheet=function(){return g=g||document.head.querySelector(l.KEG_STYLES_TAG_ID)},w=/[A-Z]/g,_=/^ms-/,j={},toHyphenLower=function(e){return"-"+e.toLowerCase()},getSelector=function(e,t,a){var filterWithPrefix=function(e){return e&&a?e.startsWith(a):e},i=!!n(e)&&(r(e)?e.filter(filterWithPrefix).pop():o(e)&&e.split(" ").filter(filterWithPrefix).pop()),c="keg-".concat(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!o(e)||0==e.length)return 0;e=e.split("").reverse().join("");for(var r=0,n=0;n<e.length;n++){var a=e.charCodeAt(n);r=(r<<5)-r+a,r="".concat(Math.abs(r&r))}return t?r.slice(0,t):r}(t));return{hashClass:c,selector:i?".".concat(i.trim(),".").concat(c).trim():".".concat(c).trim()}},addStylesToDom=function(e,t){if(E&&t&&!function(e){return T.has(e)}(e)){T.add(e);var r=getKegSheet();r.sheet.insertRule("@media all {".concat(t.all,"}"))}};c(l.BUILD_EVENT,(function(){T.clear(),getKegSheet().textContent=""})),function(){if(E){if(g=document.head.querySelector(l.KEG_STYLES_TAG_ID))return g;(g=document.createElement("style")).id=l.KEG_STYLES_TAG_ID,document.head.append(g)}}();var k=Object.freeze({}),createBlock=function(e,t){var n=C.important.concat(null==t?void 0:t.important),o=v(S(e)),a=Object.keys(o).map((function(e){var t=function(e,t,r){return r.includes(e)?"".concat(t," !important"):t}(e,o[e],n),a=function(e){if(j.hasOwnProperty(e))return j[e];var t=e.replace(w,toHyphenLower);return j[e]=_.test(t)?"-"+t:t}(e);return r(t)?t.map((function(e){return"".concat(a,":").concat(e)})).join(";"):"".concat(a,":").concat(t)})).sort().join(";");return"{".concat(a,"}")},convertToCss=function(n,o){return h(a(n,[n])).reduce((function(n,a){if(!i(a))return n;var c=function(n,o){var a=r(o)?C.filter.concat(o):C.filter;return{style:e(n,a),filtered:t(n,a)}}(a,null==o?void 0:o.filter),l=c.style,s=c.filtered;Object.assign(n.filtered,s);var u=y(l),f=b(u);return n.blocks.push(createBlock(f,o)),n}),{blocks:[],filtered:{}})},useStyleTag=function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0;o=i(o)?o:k;var c=u(),l=null==c||null===(t=c.RTMeta)||void 0===t?void 0:t.size,s=null==c||null===(r=c.RTMeta)||void 0===r?void 0:r.key;return p((function(){var t=convertToCss(e,o),r=t.blocks,i=t.filtered,c=getSelector(n,r.join(""),"keg"),l=c.hashClass,s=c.selector,u=r.reduce((function(e,t){var r="".concat(s).concat(t);return e.all+=r,e.rules.push(r),e}),{all:"",rules:[]});return addStylesToDom(s,u),{css:u,filteredStyle:i,classList:a(n,[n]).concat([l])}}),[e,n,l,s,o])},x=m.forwardRef((function(e,t){var r=e.Component,n=e.children,o=e.config,a=e.className,i=e.style,c=f(e,["Component","children","config","className","style"]),l=o.className,s=useStyleTag(i,a||l,o),u=s.classList,p=s.filteredStyle;return m.createElement(r,d({},c,{style:p,ref:t,className:u}),n)})),StyleInjector=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m.forwardRef((function(r,n){var o=r.style,a=f(r,["style"]);return o?m.createElement(x,d({},a,{style:o,config:t,Component:e,ref:n})):m.createElement(e,d({},a,{style:o,ref:n}))}))};export{StyleInjector,convertToCss,createBlock,useStyleTag};
//# sourceMappingURL=styleInjector.js.map
