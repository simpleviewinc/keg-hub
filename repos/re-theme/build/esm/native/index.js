import e,{useState as r,useEffect as t,useMemo as n,useContext as o,useCallback as i,useRef as a,useLayoutEffect as u}from"react";import{isFunc as f,isNum as c,isArr as l,deepFreeze as d,isObj as s,logData as p,mapObj as y,softFalsy as m,toNum as h,reduceObj as v,unset as b,deepMerge as g,isEmpty as _,get as P,isStr as w,checkCall as T,isEmptyColl as O,jsonEqual as A}from"@keg-hub/jsutils";var E,loadReactNativeDimensions=function(){return require("react-native").Dimensions},checkDimensions=function(e){return function(){return(E=E||loadReactNativeDimensions())?e.apply(void 0,arguments):console.error("[ ReTheme ERROR ] - Missing Dimensions","\n   - You must initialize 'Dimensions' before using the 'ReThemeProvider'","\n   - Do this by calling 'setRNDimensions(Dimensions)'","\n   - The first argument must be the 'Dimensions' export of 'react-native'","\n   - Or an Object with a matching API")}},S={get:checkDimensions((function(){var e;return E?(e=E).get.apply(e,arguments):{width:0,height:0}})),set:checkDimensions((function(){var e;E&&(e=E).set.apply(e,arguments)})),update:checkDimensions((function(){var e;E&&(e=E).update.apply(e,arguments)})),addEventListener:checkDimensions((function(){var e;E&&(e=E).addEventListener.apply(e,arguments)})),removeEventListener:checkDimensions((function(){var e;E&&(e=E).removeEventListener.apply(e,arguments)}))};function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _extends(){return(_extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function _objectSpread2(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _objectWithoutProperties(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function _slicedToArray(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],n=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(t.push(a.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(o)throw i}}return t}(e,r)||_unsupportedIterableToArray(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toConsumableArray(e){return function(e){if(Array.isArray(e))return _arrayLikeToArray(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||_unsupportedIterableToArray(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var x={},addThemeEvent=function(e,r){if(e&&f(r))return x[e]=x[e]||[],x[e].push(r),x[e].length-1},removeThemeEvent=function(e,r){e&&x[e]&&(r||0===r)&&(c(r)?x[e].splice(r,1):f(r)&&l(x[e])&&(x[e]=x[e].filter((function(e){return e!==r}))))},fireThemeEvent=function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];l(x[e])&&x[e].forEach((function(e){return e.apply(void 0,t)}))},j=d({BUILD_EVENT:"build",CHANGE_EVENT:"change",RESIZE_EVENT:"resize",ADD_EVENT:"addEventListener",REMOVE_EVENT:"removeEventListener",KEG_STYLES_TAG_ID:"keg-components-stylesheet",PLATFORM:{NATIVE:"$native",IOS:"$ios",android:"$android",WEB:"$web",ALL:"$all"}}),C={entries:[["$xsmall",1],["$small",320],["$medium",768],["$large",1024],["$xlarge",1366]],hash:{},indexes:{}},buildSizeMapParts=function(){C.indexes=C.entries.reduce((function(e,r,t){return e[r[0]]=t,e[t]=r[0],C.hash[r[0]]=r[1],e}),{})},setSizes=function(e){return s(e)?(y(e,(function(r,t){var n=C.indexes[r];if(!m(n))return p("Invalid ".concat(r," for theme size! Allowed keys are xsmall | small | medium | large | xlarge"),"warn");var o=h(e[r]);if(!o||!C.entries[n])return p("Invalid size entry. Size must be a number and the size entry must exist!","Size: ".concat(o),"Entry: ".concat(C.entries[n]),"warn");C.entries[n]=[r,o]})),buildSizeMapParts(),C):p("setDimensions method requires an argument of type 'Object'.\nReceived: ",e,"error")},getSize=function(e){var r=c(e)&&e||h(e),t=C.entries.reduce((function(e,t){var n=_slicedToArray(t,2),o=n[0],i=n[1];return r>=i&&(e?i>C.hash[e]&&(e=o):e=o),e}),"$xsmall");return[t,C.hash[t]]},getMergeSizes=function(e){return C.entries.slice(0,C.indexes[e]+1).map((function(e){var r=_slicedToArray(e,2),t=r[0];r[1];return t}))};buildSizeMapParts();var L,$,getSizeMap=function(){return C},useDimensions=function(){var e=_slicedToArray(r(S.get("window")),2),n=e[0],o=e[1],onChange=function(e){var r=e.window,t=r.width,n=r.height,i=r.scale,a=r.fontScale;o({width:t,height:n,scale:i,fontScale:a})};return t((function(){return S.addEventListener("change",onChange),function(){return onChange.shouldUnmount=!0,S.removeEventListener("change",onChange)}}),[]),n},R=(_defineProperty(L={m:"margin",mT:"marginTop",mB:"marginBottom",mR:"marginRight",mL:"marginLeft",mH:"marginHorizontal",mV:"marginVertical",p:"padding",pT:"paddingTop",pB:"paddingBottom",pR:"paddingRight",pL:"paddingLeft",pH:"paddingHorizontal",pV:"paddingVertical",bC:"borderColor",bCT:"borderTopColor",bCB:"borderBottomColor",bCR:"borderRightColor",bCL:"borderLeftColor",bW:"borderWidth",bS:"borderStyle"},"bC","borderColor"),_defineProperty(L,"bRad","borderRadius"),_defineProperty(L,"c","color"),_defineProperty(L,"bg","background"),_defineProperty(L,"bgC","backgroundColor"),_defineProperty(L,"d","display"),_defineProperty(L,"ovf","overflow"),_defineProperty(L,"ovfX","overflowX"),_defineProperty(L,"ovfY","overflowY"),_defineProperty(L,"pos","position"),_defineProperty(L,"z","zIndex"),_defineProperty(L,"tp","top"),_defineProperty(L,"bt","bottom"),_defineProperty(L,"btm","bottom"),_defineProperty(L,"lt","left"),_defineProperty(L,"rt","right"),_defineProperty(L,"bxS","boxShadow"),_defineProperty(L,"op","opacity"),_defineProperty(L,"ptrE","pointerEvents"),_defineProperty(L,"otl","outline"),_defineProperty(L,"fl","flex"),_defineProperty(L,"flD","flexDirection"),_defineProperty(L,"flWr","flexWrap"),_defineProperty(L,"flB","flexBasis"),_defineProperty(L,"flS","flexShrink"),_defineProperty(L,"jtC","justifyContent"),_defineProperty(L,"alC","alignContent"),_defineProperty(L,"alS","alignSelf"),_defineProperty(L,"alI","alignItems"),_defineProperty(L,"w","width"),_defineProperty(L,"h","height"),_defineProperty(L,"minH","minHeight"),_defineProperty(L,"maxH","maxHeight"),_defineProperty(L,"minW","minWidth"),_defineProperty(L,"maxW","maxWidth"),_defineProperty(L,"ftF","fontFamily"),_defineProperty(L,"ftSz","fontSize"),_defineProperty(L,"ftS","fontStyle"),_defineProperty(L,"ftWt","fontWeight"),_defineProperty(L,"lnH","lineHeight"),_defineProperty(L,"ltrS","letterSpacing"),_defineProperty(L,"txAl","textAlign"),_defineProperty(L,"txDc","textDecoration"),L),k={OS:"web",select:function(e){return s(e)&&e.web},Version:"ReTheme"},getRNPlatform=function(){return $||k},setRNPlatform=function(e){$=e},buildPlatforms=function(e){var r,t,n=Object.keys(e).filter((function(r){return e[r]}));return(r=getRNPlatform(),t=["$"+P(r,"OS")],"web"!==P(r,"OS")&&t.push("$native"),t.concat([j.PLATFORM.ALL])).reduce((function(r,t){return!1!==e[t]&&-1===r.indexOf(t)&&r.unshift(t),r}),n)},D=function buildSizedThemes(e,r,t){return v(e,(function(r,n,o){if(R[r]&&(b(e,r),e[R[r]]=n),!s(n))return o;if(r===t){var i=g(o,n);return b(e,[t]),i}var a=buildSizedThemes(n,o[r]||{},t);return _(a)||(o[r]=a),o}),r)},updatePlatformTheme=function(e,r,t){if(!s(t))return t;var n=t.$class,o=t.$className,i=_objectWithoutProperties(t,["$class","$className"]),a=getPlatformTheme(function(e,r){var t=getSizeMap(),n=[],o=Object.keys(e).reduce((function(o,i){return"$"!==i[0]||t.hash[i]?o[i]=e[i]:-1!==r.indexOf(i)&&n.push(e[i]),o}),{});return n.length?g.apply(void 0,n):o}(i,e),e,r),u=o||n;return u&&(a.$class=u),a},getPlatformTheme=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e?v(e,(function(e,n,o){return o[e]=updatePlatformTheme(r,t,n),o}),e):e},I={},getCurrentTheme=function(){return I},getTheme=function(){for(var e=getCurrentTheme(),r=arguments.length,t=new Array(r),n=0;n<r;n++)t[n]=arguments[n];return g.apply(void 0,_toConsumableArray(t.reduce((function(r,t){var n=s(t)?t:w(t)||l(t)?P(e,t):null;return n&&r.push(n),r}),[])))},hasManyFromTheme=function(e){return s(e)&&s(e.RTMeta)},joinTheme=function(e,r){for(var t=arguments.length,n=new Array(t>2?t-2:0),o=2;o<t;o++)n[o-2]=arguments[o];return n=l(r)?[].concat(_toConsumableArray(r.map((function(r){return s(r)&&r||r&&P(e,r)}))),_toConsumableArray(n)):[r].concat(n),hasManyFromTheme(e)?getTheme.apply(void 0,_toConsumableArray(n)):getTheme.apply(void 0,[e].concat(_toConsumableArray(n)))},z={},mergeWithDefault=function(e,r,t){return function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=getRNPlatform();return Object.keys(getSizeMap().hash).reduce((function(r,t){var n=D(e,e[t]||{},t);return _(n)||(r[t]=n),r}),getPlatformTheme(e,buildPlatforms(r),t))}(g(r&&e!==r?r:{},e),t)},buildTheme=function(e,r,t,n,o){if(!s(e))return e;s(o)||(o={});var i=_slicedToArray(getSize(r),2),a=i[0],u={key:a,size:i[1],width:r,height:t};if(z&&e===z.theme)return useCachedTheme(z,u);var f=mergeWithDefault(e,n,o),c=(f.$xsmall,f.$small,f.$medium,f.$large,f.$xlarge,_objectWithoutProperties(f,["$xsmall","$small","$medium","$large","$xlarge"]));return configureBuiltTheme(z={extraTheme:c,mergedTheme:f,theme:e,key:a},u)},useCachedTheme=function(e,r){return r.key!==e.key?configureBuiltTheme(e,r):T((function(){var e=getCurrentTheme();return fireThemeEvent(j.BUILD_EVENT,e),e}))},configureBuiltTheme=function(e,r){var t=e.mergedTheme,n=e.extraTheme;z.key=r.key;var o=r.size?function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=getMergeSizes(r);return g.apply(void 0,[t].concat(_toConsumableArray(n.reduce((function(r,t){return e[t]&&r.push(e[t]),r}),[]))))}(t,r.key,n):n;return o.get=getTheme,o.join=joinTheme,o.RTMeta=_objectSpread2(_objectSpread2({},o.RTMeta),r),I=o,fireThemeEvent(j.BUILD_EVENT,o),o},V={},setDefaultTheme=function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!s(e))return console.warn("setDefaultTheme method requires an theme object as the first argument. Received: ",e);V=r?g(V,e):e;var t=S.get("window"),n=buildTheme(V,t.width,t.height);return n},getDefaultTheme=function(){return V},W=e.createContext(getDefaultTheme()),withTheme=function(r){return function(t){return e.createElement(W.Consumer,null,(function(n){return e.createElement(r,_extends({theme:n},t))}))}},ReThemeProvider=function(o){var i=o.children,a=o.theme,u=o.merge,f=o.platforms,c=Boolean(u||!u&&!1!==u)||!1,l=_slicedToArray(r(S.get("window")),2),d=l[0],s=l[1],onChange=function(e){var r=e.window,t=r.width,n=r.height,o=r.scale,i=r.fontScale,a=getSize(t);if(a){var u=a[0],f=getCurrentTheme();u!==P(f,["RTMeta","key"])&&s({width:t,height:n,scale:o,fontScale:i})}};t((function(){return S.addEventListener("change",onChange),function(){S.removeEventListener("change",onChange)}}),[]);var p=n((function(){return buildTheme(a,d.width,d.height,c&&getDefaultTheme(),f)}),[a,d.width,d.height,c,f]);return e.createElement(W.Provider,{value:p},i)},setRNDimensions=function(e){return e},useTheme=function(){return o(W)},useStylesCallback=function(e,r,t){var o=i(e,r||[]),a=!(!t||!s(t)||O(t))&&t,u=useTheme();return n((function(){return T.apply(void 0,[o,u,a].concat(_toConsumableArray(r)))||{}}),[u,o,a])},nativeThemeHook=function(e,t,n){var o=P(n,"ref",a()),i=_slicedToArray(r(e),2),f=i[0],c=i[1];return u((function(){var r,t;(r=e)!==(t=f)&&!A(r,t)&&c(f)}),[e,t]),[o,e,c]};export{W as ReThemeContext,ReThemeProvider,addThemeEvent,fireThemeEvent,getDefaultTheme,getMergeSizes,getSize,getSizeMap,removeThemeEvent,setDefaultTheme,setRNDimensions,setRNPlatform,setSizes,useDimensions,useStylesCallback,useTheme,nativeThemeHook as useThemeActive,nativeThemeHook as useThemeFocus,nativeThemeHook as useThemeHover,withTheme};
//# sourceMappingURL=index.js.map
