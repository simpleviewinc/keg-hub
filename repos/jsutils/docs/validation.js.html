<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>validation.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-array.html">array</a><ul class='methods'><li data-type='method'><a href="module-array.html#.cloneArr">cloneArr</a></li><li data-type='method'><a href="module-array.html#.flatMap">flatMap</a></li><li data-type='method'><a href="module-array.html#.isArr">isArr</a></li><li data-type='method'><a href="module-array.html#.omitRange">omitRange</a></li><li data-type='method'><a href="module-array.html#.randomizeArr">randomizeArr</a></li><li data-type='method'><a href="module-array.html#.uniqArr">uniqArr</a></li></ul></li><li><a href="module-boolean.html">boolean</a><ul class='methods'><li data-type='method'><a href="module-boolean.html#.convertToStrBool">convertToStrBool</a></li><li data-type='method'><a href="module-boolean.html#.isStrBool">isStrBool</a></li><li data-type='method'><a href="module-boolean.html#.softFalsy">softFalsy</a></li><li data-type='method'><a href="module-boolean.html#.toBool">toBool</a></li></ul></li><li><a href="module-collection.html">collection</a><ul class='methods'><li data-type='method'><a href="module-collection.html#.deepClone">deepClone</a></li><li data-type='method'><a href="module-collection.html#.get">get</a></li><li data-type='method'><a href="module-collection.html#.isColl">isColl</a></li><li data-type='method'><a href="module-collection.html#.isEmptyColl">isEmptyColl</a></li><li data-type='method'><a href="module-collection.html#.mapColl">mapColl</a></li><li data-type='method'><a href="module-collection.html#.reduceColl">reduceColl</a></li><li data-type='method'><a href="module-collection.html#.repeat">repeat</a></li><li data-type='method'><a href="module-collection.html#.set">set</a></li><li data-type='method'><a href="module-collection.html#.shallowEqual">shallowEqual</a></li><li data-type='method'><a href="module-collection.html#.unset">unset</a></li><li data-type='method'><a href="module-collection.html#~cloneObjWithPrototypeAndProperties">cloneObjWithPrototypeAndProperties</a></li></ul></li><li><a href="module-functions.html">functions</a><ul class='methods'><li data-type='method'><a href="module-functions.html#.applyToFunc">applyToFunc</a></li><li data-type='method'><a href="module-functions.html#.checkCall">checkCall</a></li><li data-type='method'><a href="module-functions.html#.cloneFunc">cloneFunc</a></li><li data-type='method'><a href="module-functions.html#.debounce">debounce</a></li><li data-type='method'><a href="module-functions.html#.doIt">doIt</a></li><li data-type='method'><a href="module-functions.html#.eitherFunc">eitherFunc</a></li><li data-type='method'><a href="module-functions.html#.isFunc">isFunc</a></li><li data-type='method'><a href="module-functions.html#.limbo">limbo</a></li><li data-type='method'><a href="module-functions.html#.match">match</a></li><li data-type='method'><a href="module-functions.html#.memorize">memorize</a></li><li data-type='method'><a href="module-functions.html#.throttle">throttle</a></li><li data-type='method'><a href="module-functions.html#.throttleLast">throttleLast</a></li><li data-type='method'><a href="module-functions.html#.uuid">uuid</a></li></ul></li><li><a href="module-Helpers.html">Helpers</a><ul class='methods'><li data-type='method'><a href="module-Helpers.html#.isEmpty">isEmpty</a></li><li data-type='method'><a href="module-Helpers.html#.isSame">isSame</a></li><li data-type='method'><a href="module-Helpers.html#.isValidDate">isValidDate</a></li><li data-type='method'><a href="module-Helpers.html#.strToType">strToType</a></li><li data-type='method'><a href="module-Helpers.html#.typeOf">typeOf</a></li></ul></li><li><a href="module-log.html">log</a><ul class='methods'><li data-type='method'><a href="module-log.html#.logData">logData</a></li><li data-type='method'><a href="module-log.html#.resetLogs">resetLogs</a></li><li data-type='method'><a href="module-log.html#.setLogs">setLogs</a></li></ul></li><li><a href="module-number.html">number</a><ul class='methods'><li data-type='method'><a href="module-number.html#.equalsNaN">equalsNaN</a></li><li data-type='method'><a href="module-number.html#.getNums">getNums</a></li><li data-type='method'><a href="module-number.html#.isFloat">isFloat</a></li><li data-type='method'><a href="module-number.html#.isInt">isInt</a></li><li data-type='method'><a href="module-number.html#.isNum">isNum</a></li><li data-type='method'><a href="module-number.html#.nth">nth</a></li><li data-type='method'><a href="module-number.html#.toFloat">toFloat</a></li><li data-type='method'><a href="module-number.html#.toInt">toInt</a></li><li data-type='method'><a href="module-number.html#.toNum">toNum</a></li></ul></li><li><a href="module-object.html">object</a><ul class='methods'><li data-type='method'><a href="module-object.html#.applyToCloneOf">applyToCloneOf</a></li><li data-type='method'><a href="module-object.html#.clearObj">clearObj</a></li><li data-type='method'><a href="module-object.html#.deepFreeze">deepFreeze</a></li><li data-type='method'><a href="module-object.html#.deepMerge">deepMerge</a></li><li data-type='method'><a href="module-object.html#.eitherObj">eitherObj</a></li><li data-type='method'><a href="module-object.html#.everyEntry">everyEntry</a></li><li data-type='method'><a href="module-object.html#.filterObj">filterObj</a></li><li data-type='method'><a href="module-object.html#.hasOwn">hasOwn</a></li><li data-type='method'><a href="module-object.html#.isObj">isObj</a></li><li data-type='method'><a href="module-object.html#.jsonEqual">jsonEqual</a></li><li data-type='method'><a href="module-object.html#.keyMap">keyMap</a></li><li data-type='method'><a href="module-object.html#.mapKeys">mapKeys</a></li><li data-type='method'><a href="module-object.html#.mapObj">mapObj</a></li><li data-type='method'><a href="module-object.html#.omitKeys">omitKeys</a></li><li data-type='method'><a href="module-object.html#.pickKeys">pickKeys</a></li><li data-type='method'><a href="module-object.html#.reduceObj">reduceObj</a></li><li data-type='method'><a href="module-object.html#.sanitizeCopy">sanitizeCopy</a></li><li data-type='method'><a href="module-object.html#.someEntry">someEntry</a></li><li data-type='method'><a href="module-object.html#.toObj">toObj</a></li><li data-type='method'><a href="module-object.html#.trimStringFields">trimStringFields</a></li></ul></li><li><a href="module-promise.html">promise</a><ul class='methods'><li data-type='method'><a href="module-promise.html#.promisifyAll">promisifyAll</a></li><li data-type='method'><a href="module-promise.html#.wait">wait</a></li></ul></li><li><a href="module-string.html">string</a><ul class='methods'><li data-type='method'><a href="module-string.html#.camelCase">camelCase</a></li><li data-type='method'><a href="module-string.html#.capitalize">capitalize</a></li><li data-type='method'><a href="module-string.html#.cleanStr">cleanStr</a></li><li data-type='method'><a href="module-string.html#.containsStr">containsStr</a></li><li data-type='method'><a href="module-string.html#.delimitString">delimitString</a></li><li data-type='method'><a href="module-string.html#.eitherStr">eitherStr</a></li><li data-type='method'><a href="module-string.html#.isEmail">isEmail</a></li><li data-type='method'><a href="module-string.html#.isLowerCase">isLowerCase</a></li><li data-type='method'><a href="module-string.html#.isPhone">isPhone</a></li><li data-type='method'><a href="module-string.html#.isStr">isStr</a></li><li data-type='method'><a href="module-string.html#.isUpperCase">isUpperCase</a></li><li data-type='method'><a href="module-string.html#.isUrl">isUrl</a></li><li data-type='method'><a href="module-string.html#.isUuid">isUuid</a></li><li data-type='method'><a href="module-string.html#.mapString">mapString</a></li><li data-type='method'><a href="module-string.html#.parseJSON">parseJSON</a></li><li data-type='method'><a href="module-string.html#.plural">plural</a></li><li data-type='method'><a href="module-string.html#.removeDot">removeDot</a></li><li data-type='method'><a href="module-string.html#.sanitize">sanitize</a></li><li data-type='method'><a href="module-string.html#.singular">singular</a></li><li data-type='method'><a href="module-string.html#.snakeCase">snakeCase</a></li><li data-type='method'><a href="module-string.html#.styleCase">styleCase</a></li><li data-type='method'><a href="module-string.html#.toStr">toStr</a></li><li data-type='method'><a href="module-string.html#.trainCase">trainCase</a></li><li data-type='method'><a href="module-string.html#.wordCaps">wordCaps</a></li></ul></li><li><a href="module-url.html">url</a><ul class='methods'><li data-type='method'><a href="module-url.html#.isValidUrl">isValidUrl</a></li><li data-type='method'><a href="module-url.html#.objToQuery">objToQuery</a></li></ul></li><li><a href="module-validation.html">validation</a><ul class='methods'><li data-type='method'><a href="module-validation.html#.validate">validate</a></li><li data-type='method'><a href="module-validation.html#~handleFailure">handleFailure</a></li><li data-type='method'><a href="module-validation.html#~validateArgument">validateArgument</a></li><li data-type='method'><a href="module-validation.html#~validationReducer">validationReducer</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">validation.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module validation */

const OPTIONS = {
  SHOULD_LOG: true,
  SHOULD_THROW: false,
  LOG_PREFIX: null
}

/** 
 *  Validates each key-value entry in argObj using the validator functions in validators with matching keys. 
 *  For any failures, validate will console.error the reason.
 *  @param { Object } argObj - object, where keys are the name of the argument to validate, and value is its value
 *  @param { Object } validators - object, where keys match the argument and values are predicate functions (return true/false and are passed the arg with the same key). 
 *     - Use the `$default` key to define a default validator, which will validate any argument that doesn't have a custom validator defined.
 *  @param { Object } options - contains `logs` and `throws` props. When a validation fails, it will throw an error if `throws` is true. Else it logs error if `logs` is true.
 *  @returns { Array } - an entry with two values [ success, results ]. 
 *     - success: { Boolean } that is true if all arguments passed their validators, false otherwise
 *     - results: { Object } that holds the validation results for each argument, keyed by the same keys as in argObj. For each
 *                result object, the properties are: { success, key, value, validator, reason }.
 *  @function
 *  @example 
 *    const elements = {}
 *    const name = 'michael'
 *    const address = '12345 E. Street'
 *    const [ isValid, results ] = validate(
 *      { elements, name, address },
 *      { elements: isArr, $default: isStr }
 *    )
 *    console.log(isValid) // false
 *    console.log(results.elements.success) // false
 */
export const validate = (argObj, validators={}, { logs=OPTIONS.SHOULD_LOG, throws=OPTIONS.SHOULD_THROW, prefix=OPTIONS.LOG_PREFIX }={}) => {
  const validationCaseEntries = Object.entries(argObj)

  // if no default or custom validator set for an arg, just assert it is valid
  const defaultValidator = () => true

  // validate each argument
  const validationResults = validationCaseEntries.map(
    ([argName, argValue]) => validateArgument(
      argName,
      argValue,
      validators[argName] || validators['$default'] || defaultValidator
    )
  )

  // reduce the argument validation results into a single object of form { success, cases }.
  // success is true if all arguments passed their validators. Cases holds each argument's validation results.
  const reduceCases = (total, next) => validationReducer(total, next, { logs, throws, prefix })
  const { success, cases } = validationResults.reduce(reduceCases, { success: true, cases: {} })

  return [ success, cases ]
}

/**
 * If you need to configure validation properties globally, you can do so here. These are overridden by the validate options arguments,
 * if one is defined in validate().
 * @function
 * @param {Object} options 
 * @param {Boolean} options.logs - indicates you want validate() to log errors when a case fails
 * @param {Boolean} options.throws - indicates validate() should throw an error when a case fails
 * @param {String} options.prefix - a prefix to any console error logs or to messages of errors thrown
 */
validate.setOptions = ({ logs, throws, prefix }) => {
  if (logs !== undefined) {
    OPTIONS.SHOULD_LOG = logs
  }
  if (throws !== undefined) {
    OPTIONS.SHOULD_THROW = throws
  }
  if (prefix !== undefined) {
    OPTIONS.LOG_PREFIX = prefix
  }
}

/**
 * Resets the global validation options to their defaults
 * @function
 */
validate.resetOptions = () => {
  OPTIONS.SHOULD_LOG = true
  OPTIONS.SHOULD_THROW = false
  OPTIONS.LOG_PREFIX = null
}

/**
 * Helper for `validate`. Validates a single value given a validator
 * @param {*} key 
 * @param {*} value 
 * @param {Function} validator 
 * @returns {Object} of form { success, reason }
 */
const validateArgument = (key, value, validator) => {
  const success = validator(value)

  // if validator is a named function, use its name. If it is an inline anonymous arrow function, its name
  // matches the argument key and it has no useful/descriptive name, so just stringify it
  const shouldStringifyValidator = !validator.name || (validator.name === key) || (validator.name === '$default')
  const validatorString = shouldStringifyValidator ? validator.toString() : validator.name

  const reason = success
    ? null
    : [
      `Argument "${key}" with value `, 
      value, 
      ` failed validator: ${validatorString}.`
    ] 
   
  return { success, key, value, validator, reason }
}

/**
 * Helper for `validate`. Reduces validations into a single object of form { success, cases }
 * @param {*} finalResult 
 * @param {*} nextValidation 
 */
const validationReducer = (finalResult, nextValidation, { logs, throws, prefix }) => {
  // handle the failure
  !nextValidation.success &amp;&amp; handleFailure(nextValidation, logs, throws, prefix)

  return {
    success: finalResult.success &amp;&amp; nextValidation.success,
    cases: {
      ...finalResult.cases,
      [nextValidation.key]: nextValidation
    }
  }
}

/**
 * Handles a validation failure given validation options
 * @param {Object} validation 
 * @param {Boolean} shouldLog 
 * @param {Boolean} shouldThrow 
 * @param {String} prefix - optional prefix to any error or console log 
 */
const handleFailure = (validation, shouldLog, shouldThrow, prefix) => {
  // prepend the prefix if one is defined
  const reason = prefix
    ? [ prefix, ...validation.reason ]
    : validation.reason

  if (shouldThrow)
    throw new Error(reason.join())
  
  if (shouldLog)
    console.error(...reason)
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Wed Feb 05 2020 14:37:42 GMT-0700 (Mountain Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
