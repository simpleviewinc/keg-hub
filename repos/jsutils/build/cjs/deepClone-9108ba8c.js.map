{"version":3,"file":"deepClone-9108ba8c.js","sources":["../../src/method/cloneFunc.js","../../src/collection/deepClone.js"],"sourcesContent":["/** @module functions */\n\nimport { get } from '../collection/get'\n\n/**\n * Clones a function using the Function constructor and calling toString on the passed in function\n * @example\n * const func = () => { console.log('test') }\n * const clone = cloneFunc(func)\n * // clone !== func\n * @function\n * @param {function} func - function to clone\n *\n * @returns {Object} cloned function\n */\nexport const cloneFunc = func => {\n\n  const funcClone = function(...args){\n    return func instanceof funcClone\n      ? (() => { return new func(...args) })()\n      : get(func.prototype, 'constructor.name')\n        ? new func(...args)\n        : func.apply(func, args)\n  }\n\n  for(let key in func )\n    func.hasOwnProperty(key) && (funcClone[key] = func[key])\n  \n  Object.defineProperty(funcClone, 'name', { value: func.name, configurable: true })\n  funcClone.toString = () => func.toString()\n\n  return funcClone\n}\n","/** @module collection */\n\nimport { isFunc } from '../method/isFunc'\nimport { cloneFunc } from '../method/cloneFunc'\nimport { isArr } from '../array/isArr'\n\n/**\n * Recursively clones an object or array.\n  * @example\n * const test = { foo: [ { bar: 'baz' } ] }\n * const clone = deepClone(test)\n * console.log(test === clone)) // prints false\n * console.log(test.foo === clone.foo) // prints false\n * @example\n * // Works with array too\n * deepClone([ [ [ 0 ] ] ])\n * // Returns copy of the passed in collection item\n * @function\n * @param {Object} obj - object to clone\n * @return {Object} - cloned Object\n */\nexport const deepClone = (obj, hash = new WeakMap()) => {\n  if (Object(obj) !== obj) return obj\n  if (obj instanceof Set) return new Set(obj)\n  if (hash.has(obj)) return hash.get(obj)\n  if (isArr(obj)) return obj.map(x => deepClone(x))\n  if (isFunc(obj)) return cloneFunc(obj)\n\n  const result = obj instanceof Date \n    ? new Date(obj)\n    : obj instanceof RegExp \n      ? new RegExp(obj.source, obj.flags)\n      : (!obj.constructor)\n        ? Object.create(null)\n        : null\n  \n  // if result is null, object has a constructor and wasn't an instance of Date nor RegExp\n  if (result === null) return cloneObjWithPrototypeAndProperties(obj)\n\n  hash.set(obj, result)\n\n  if (obj instanceof Map)\n    return Array.from(obj, ([key, val]) => result.set(key, deepClone(val, hash)) )\n\n  return Object\n    .assign(\n      result,\n      ...Object.keys(obj)\n        .map(key => ({ [key]: deepClone(obj[key], hash) }))\n    )\n}\n\n/**\n * Helper for deepClone. Deeply clones the object, including its properties, and preserves the prototype and isFrozen and isSealed state\n * @function\n * @ignore\n * @param {Object} objectWithPrototype - any object that has a prototype\n * @returns {Object} the cloned object \n */\nexport const cloneObjWithPrototypeAndProperties = (objectWithPrototype) => {\n\n  if (!objectWithPrototype) return objectWithPrototype\n\n  const prototype = Object.getPrototypeOf(objectWithPrototype)\n  const sourceDescriptors = Object.getOwnPropertyDescriptors(objectWithPrototype)\n\n  for (const [key, descriptor] of Object.entries(sourceDescriptors)) {\n    descriptor.value &&\n      ( sourceDescriptors[key].value = deepClone(descriptor.value) )\n  }\n\n  const clone = Object.create(prototype, sourceDescriptors)\n\n  if (Object.isFrozen(objectWithPrototype)) Object.freeze(clone)\n  if (Object.isSealed(objectWithPrototype)) Object.seal(clone)\n\n  return clone \n}\n"],"names":["cloneFunc","func","funcClone","args","get","prototype","apply","key","hasOwnProperty","Object","defineProperty","value","name","configurable","toString","deepClone","obj","hash","WeakMap","Set","has","isArr","map","x","isFunc","result","Date","RegExp","source","flags","constructor","create","cloneObjWithPrototypeAndProperties","set","Map","Array","from","val","assign","keys","objectWithPrototype","getPrototypeOf","sourceDescriptors","getOwnPropertyDescriptors","descriptor","entries","clone","isFrozen","freeze","isSealed","seal"],"mappings":"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"}